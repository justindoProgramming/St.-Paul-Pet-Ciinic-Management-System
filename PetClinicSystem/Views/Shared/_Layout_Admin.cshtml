@{
    var name = Context.Session.GetString("UserName");
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Admin - St. Paul Clinic</title>

    <!-- CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <link rel="stylesheet" href="~/css/site.css" />
</head>

<body class="bg-light">

    <!-- SIDEBAR -->
    <div class="typeface sidebar">

        <div class="sidebar-logo mb-4">
            <i class="fa-solid fa-heart text-success me-2"></i>
            St. Paul Clinic
        </div>

        <div class="menu-title">Menu</div>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Dashboard" ? "nav-active" : "")"
           href="/Admin/Index">
            <i class="fa-solid fa-gauge me-2"></i> Dashboard
        </a>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Appointments" ? "nav-active" : "")"
           href="/Appointments/Index">
            <i class="fa-solid fa-calendar-check me-2"></i> Appointments
        </a>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Pets" ? "nav-active" : "")"
           href="/Pets/Index">
            <i class="fa-solid fa-paw me-2"></i> Patients
        </a>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Billing" ? "nav-active" : "")"
           href="/BillingPharmacy/Index">
            <i class="fa-solid fa-receipt me-2"></i> Billing & Pharmacy
        </a>

        @* MANAGE ACCOUNTS – now points to ManageAccounts controller *@
        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "ManageAccounts" ? "nav-active" : "")"
           href="/ManageAccounts/Index">
            <i class="fa-solid fa-user-doctor me-2"></i> Manage Accounts
        </a>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Records" ? "nav-active" : "")"
           href="/MedicalRecords/Index">
            <i class="fa-solid fa-file-medical me-2"></i> Medical Records
        </a>

        <a class="nav-link nav-link-custom @(ViewBag.ActiveMenu == "Settings" ? "nav-active" : "")"
           href="/Settings/Index">
            <i class="fa-solid fa-gear me-2"></i> Settings
        </a>

        <a href="/Account/Logout" class="btn btn-outline-danger logout-btn">
            <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
        </a>

    </div>

    <!-- TOPBAR -->
    <div class="topbar">
        <h5 class="fw-bold">Admin Dashboard</h5>

        <div class="d-flex align-items-center gap-3">
            <span class="fw-semibold">@name</span>
            <div class="user-circle">
                @name?[0]
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="content-area">
        @RenderBody()
    </div>

    <!-- REQUIRED JS FOR MODALS & AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Per-view scripts -->
    @RenderSection("Scripts", required: false)

    <!-- GLOBAL TOAST (for success/error messages) -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
        <div id="bpToast"
             class="toast text-white"
             role="alert"
             aria-live="assertive"
             aria-atomic="true">
            <div class="toast-body fw-semibold" id="bpToastBody">
                <!-- message injected by JS -->
            </div>
        </div>
    </div>

    <script>
        // Generic toast: type = "success" | "error"
        function showBpToast(message, type) {
            var toastEl = document.getElementById('bpToast');
            var bodyEl = document.getElementById('bpToastBody');

            if (!toastEl || !bodyEl) return;

            bodyEl.textContent = message || '';

            // reset bg classes
            toastEl.classList.remove('bg-success', 'bg-danger');
            if (type === 'error') {
                toastEl.classList.add('bg-danger');
            } else {
                toastEl.classList.add('bg-success');
            }

            var t = new bootstrap.Toast(toastEl);
            t.show();
        }

        // safety: remove leftover backdrops when modals hide
        document.addEventListener('hidden.bs.modal', function () {
            document.body.classList.remove('modal-open');
            document.querySelectorAll('.modal-backdrop').forEach(function (e) { e.remove(); });
        });
    </script>

    <!-- Generic modal (if you want to reuse it somewhere) -->
    <div class="modal fade" id="mainModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content"></div>
        </div>
    </div>
    <!-- GLOBAL TOAST (top-right) -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
        <div id="appToast"
             class="toast align-items-center text-white bg-success"
             role="alert"
             aria-live="assertive"
             aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body fw-semibold">
                    <!-- message injected by JS -->
                </div>
                <button type="button"
                        class="btn-close btn-close-white me-2 m-auto"
                        data-bs-dismiss="toast"
                        aria-label="Close"></button>
            </div>
        </div>
    </div>

    <script>
        // Main helper for all modules
        function showAppToast(message, type) {
            var el = document.getElementById('appToast');
            if (!el) {
                alert(message || '');
                return;
            }

            var body = el.querySelector('.toast-body');
            body.textContent = message || '';

            // reset bg color
            el.classList.remove('bg-success', 'bg-danger', 'bg-warning');

            if (type === 'error') {
                el.classList.add('bg-danger');
            } else if (type === 'warning') {
                el.classList.add('bg-warning');
            } else {
                el.classList.add('bg-success');
            }

            var toast = bootstrap.Toast.getOrCreateInstance(el);
            toast.show();
        }

        // Backwards compatibility: if old code calls these, they still work
        window.showBpToast = showAppToast;
        window.showSuccessToast = function (msg) {
            showAppToast(msg || 'Operation completed successfully.', 'success');
        };
    </script>


</body>
</html>
