@model List<PetClinicSystem.Models.Drug>

<div class="card shadow-sm p-4 rounded-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold mb-0">Drugs Inventory</h4>

        <button class="btn btn-success px-3" type="button" onclick="loadDrugCreate()">
            <i class="fa-solid fa-plus me-1"></i> Add Drug
        </button>
    </div>

    <!-- SEARCH BAR -->
    <input type="text"
           id="drugSearchBox"
           class="form-control mb-3"
           placeholder="Search drugs by name, dosage, expiry, or notes..."
           onkeyup="filterDrugs()" />

    <!-- TABLE -->
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Name / Dosage</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-end">Unit Price</th>
                    <th class="text-end">Base Price</th>
                    <th class="text-center">Expiry</th>
                    <th class="text-center">Date Added</th>
                    <th>Restock Notes</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>

            <tbody id="drugTable">
                @if (Model != null && Model.Any())
                {
                    foreach (var d in Model)
                    {
                        var searchText =
                        $"{d.DrugName} {d.DosageType} {d.RestockNotes} {d.Quantity} " +
                        $"{d.UnitPrice} {d.BasePrice} {d.ExpiryDate:yyyy-MM-dd} {d.DateAdded:yyyy-MM-dd}";

                        <tr class="drug-row" data-search="@searchText">
                            <td>
                                <div class="fw-semibold">@d.DrugName</div>
                                <div class="text-muted small">@d.DosageType</div>
                            </td>

                            <td class="text-center">
                                <span class="badge
                                            @(d.Quantity <= 10 ? "bg-danger" :
                                                                            d.Quantity <= 30 ? "bg-warning text-dark" :
                                                                            "bg-success")">
                                    @d.Quantity
                                </span>
                            </td>

                            <td class="text-end">₱@d.UnitPrice.ToString("0.00")</td>

                            <td class="text-end">
                                @if (d.BasePrice.HasValue)
                                {
                                    @:₱@d.BasePrice.Value.ToString("0.00")
                                }
                                else
                                {
                                    <span class="text-muted small">–</span>
                                }
                            </td>

                            <td class="text-center">@d.ExpiryDate.ToString("yyyy-MM-dd")</td>

                            <td class="text-center">
                                @(d.DateAdded?.ToString("yyyy-MM-dd") ?? "-")
                            </td>

                            <td style="max-width: 240px;">
                                <span class="small text-muted">
                                    @(string.IsNullOrWhiteSpace(d.RestockNotes) ? "None" : d.RestockNotes)
                                </span>
                            </td>

                            <td class="text-end">
                                <button class="btn btn-outline-primary btn-sm me-1"
                                        onclick="loadDrugEdit(@d.DrugId)">
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>

                                <button class="btn btn-outline-danger btn-sm"
                                        onclick="loadDrugDelete(@d.DrugId)">
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="8" class="text-center text-secondary py-4">
                            <i class="fa-regular fa-folder-open fa-2x mb-2"></i>
                            <p>No drugs in inventory.</p>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>

<script>
    function filterDrugs() {
        let term = document.getElementById("drugSearchBox").value.toLowerCase();

        document.querySelectorAll(".drug-row").forEach(row => {
            let text = row.getAttribute("data-search").toLowerCase();
            row.style.display = text.includes(term) ? "" : "none";
        });
    }
</script>
